/**
 * NOVA RDV - Accessibility Styles
 * WCAG 2.2 Level AA Compliant Styles
 * Supports multi-persona accessibility needs
 */

/* ================================== */
/* FOCUS MANAGEMENT - WCAG 2.4.7 */
/* ================================== */

/* Global focus styles with 3:1 contrast minimum */
:focus-visible {
  outline: 3px solid #2563eb; /* Blue-600 for high contrast */
  outline-offset: 2px;
  border-radius: 4px;
}

/* Enhanced focus for form elements */
input:focus-visible,
select:focus-visible,
textarea:focus-visible {
  outline: 3px solid #2563eb;
  outline-offset: 2px;
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
  border-color: #2563eb;
}

/* Button focus styles with consistent visual treatment */
button:focus-visible,
[role="button"]:focus-visible {
  outline: 3px solid #2563eb;
  outline-offset: 2px;
  box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
}

/* Link focus styles */
a:focus-visible {
  outline: 3px solid #2563eb;
  outline-offset: 2px;
  border-radius: 2px;
  text-decoration: underline;
  text-decoration-thickness: 2px;
}

/* Focus within for containers */
.focus-within-ring:focus-within {
  outline: 2px solid #2563eb;
  outline-offset: 2px;
}

/* ================================== */
/* SKIP LINKS - WCAG 2.4.1 */
/* ================================== */

.skip-link {
  position: absolute;
  top: -40px;
  left: 0;
  background: #1f2937; /* Gray-800 for high contrast */
  color: #ffffff;
  padding: 12px 16px;
  z-index: 9999;
  text-decoration: none;
  border-radius: 0 0 4px 0;
  font-weight: 600;
  transition: top 0.3s ease;
}

.skip-link:focus {
  top: 0;
  outline: 3px solid #ffffff;
  outline-offset: 2px;
}

/* Prevent skip links from being hidden by sticky headers */
[id] {
  scroll-margin-top: 80px; /* Adjust based on header height */
}

/* ================================== */
/* TOUCH TARGETS - WCAG 2.5.8 */
/* ================================== */

/* Minimum touch target utilities */
.touch-target {
  min-width: 44px;
  min-height: 44px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Responsive touch targets */
@media (pointer: fine) {
  .touch-target {
    min-width: 24px;
    min-height: 24px;
  }
}

/* Touch target spacing for small elements */
.touch-spacing > * + * {
  margin-left: 24px;
}

.touch-spacing-vertical > * + * {
  margin-top: 24px;
}

/* Interactive element minimum sizes */
button,
[role="button"],
input[type="button"],
input[type="submit"] {
  min-height: 44px;
  min-width: 44px;
}

/* Form input minimum heights */
input[type="text"],
input[type="email"],
input[type="tel"],
input[type="password"],
input[type="url"],
input[type="search"],
textarea,
select {
  min-height: 44px;
  padding: 12px 16px;
}

/* ================================== */
/* COLOR CONTRAST TOKENS - WCAG 1.4.3 */
/* ================================== */

:root {
  /* Text colors - 4.5:1 minimum for normal text */
  --text-primary: neutral-800; /* Gray-900, 19.3:1 on white */
  --text-secondary: #374151; /* Gray-700, 7.04:1 on white */
  --text-tertiary: #4b5563; /* Gray-600, 5.74:1 on white */
  --text-disabled: #6b7280; /* Gray-500, 4.5:1 on white */
  --text-placeholder: #6b7280; /* Gray-500, 4.5:1 on white */
  
  /* UI colors - 3:1 minimum for non-text elements */
  --border-default: #d1d5db; /* Gray-300, 3.01:1 on white */
  --border-hover: #9ca3af; /* Gray-400, 4.1:1 on white */
  --border-focus: #2563eb; /* Blue-600, 4.5:1 on white */
  --border-error: #dc2626; /* Red-600, 4.5:1 on white */
  --border-success: #16a34a; /* Green-600, 4.5:1 on white */
  
  /* Icon colors */
  --icon-default: #6b7280; /* Gray-500, 4.5:1 on white */
  --icon-hover: #374151; /* Gray-700, 7.04:1 on white */
  --icon-disabled: #9ca3af; /* Gray-400, 4.1:1 on white */
  
  /* Background colors */
  --bg-primary: #ffffff;
  --bg-secondary: #f9fafb; /* Gray-50 */
  --bg-tertiary: #f3f4f6; /* Gray-100 */
  --bg-disabled: #f3f4f6; /* Gray-100 */
  
  /* State colors */
  --error-text: #dc2626; /* Red-600, 4.5:1 on white */
  --error-bg: #fef2f2; /* Red-50 */
  --error-border: #fecaca; /* Red-200 */
  
  --success-text: #16a34a; /* Green-600, 4.5:1 on white */
  --success-bg: #f0fdf4; /* Green-50 */
  --success-border: #bbf7d0; /* Green-200 */
  
  --warning-text: #d97706; /* Amber-600, 4.5:1 on white */
  --warning-bg: #fffbeb; /* Amber-50 */
  --warning-border: #fed7aa; /* Amber-200 */
  
  --info-text: #0369a1; /* Sky-700, 4.5:1 on white */
  --info-bg: #f0f9ff; /* Sky-50 */
  --info-border: #bae6fd; /* Sky-200 */
}

/* Apply contrast-compliant colors */
.text-primary { color: var(--text-primary); }
.text-secondary { color: var(--text-secondary); }
.text-tertiary { color: var(--text-tertiary); }
.text-disabled { color: var(--text-disabled); }

.border-default { border-color: var(--border-default); }
.border-hover:hover { border-color: var(--border-hover); }
.border-focus:focus { border-color: var(--border-focus); }

/* ================================== */
/* ERROR PATTERNS - GOV.UK STYLE */
/* ================================== */

.error-summary {
  border: 4px solid var(--error-text);
  padding: 16px;
  margin-bottom: 24px;
  background: var(--error-bg);
  border-radius: 4px;
}

.error-summary h2 {
  color: var(--error-text);
  margin-top: 0;
  margin-bottom: 12px;
  font-size: 1.125rem;
  font-weight: 600;
}

.error-summary ul {
  margin: 0;
  padding-left: 20px;
}

.error-summary li {
  margin-bottom: 8px;
}

.error-summary a {
  color: var(--error-text);
  text-decoration: underline;
  text-decoration-thickness: 2px;
  text-underline-offset: 2px;
}

.error-summary a:hover {
  text-decoration-thickness: 3px;
}

.error-message {
  color: var(--error-text);
  font-weight: 600;
  margin-top: 4px;
  display: flex;
  align-items: flex-start;
  gap: 8px;
  font-size: 0.875rem;
}

.error-message::before {
  content: "âš ";
  flex-shrink: 0;
  font-size: 1rem;
}

/* Form field error styling */
.field-error input,
.field-error textarea,
.field-error select {
  border-color: var(--error-text);
  box-shadow: 0 0 0 2px rgba(220, 38, 38, 0.1);
}

.field-error input:focus,
.field-error textarea:focus,
.field-error select:focus {
  border-color: var(--error-text);
  outline-color: var(--error-text);
  box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.1);
}

/* ================================== */
/* LOADING STATES & ANIMATIONS */
/* ================================== */

/* Skeleton loading animation */
@keyframes skeleton-loading {
  0% { 
    background-position: -200px 0; 
  }
  100% { 
    background-position: calc(200px + 100%) 0; 
  }
}

.skeleton {
  background: linear-gradient(
    90deg,
    #f3f4f6 0px,
    #e5e7eb 100px,
    #f3f4f6 200px
  );
  background-size: 200px 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
  border-radius: 4px;
}

/* Loading spinner with accessibility */
.loading-spinner {
  animation: spin 1s linear infinite;
  color: var(--text-secondary);
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* ================================== */
/* REDUCED MOTION SUPPORT */
/* ================================== */

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  
  .skeleton {
    animation: none;
    background: #f3f4f6;
  }
  
  .loading-spinner {
    animation: none;
  }
}

/* ================================== */
/* HIGH CONTRAST MODE SUPPORT */
/* ================================== */

@media (prefers-contrast: high) {
  :root {
    --text-primary: #000000;
    --text-secondary: #000000;
    --border-focus: #000000;
    --border-default: #000000;
  }
  
  button,
  input,
  select,
  textarea {
    border: 2px solid #000000;
  }
  
  button:focus,
  input:focus,
  select:focus,
  textarea:focus {
    outline: 3px solid #000000;
    outline-offset: 2px;
  }
}

/* ================================== */
/* SCREEN READER UTILITIES */
/* ================================== */

/* Screen reader only content */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* Focus-visible screen reader content */
.sr-only:focus {
  position: static;
  width: auto;
  height: auto;
  padding: 0;
  margin: 0;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

/* Live regions for dynamic content */
.live-region {
  position: absolute;
  left: -10000px;
  width: 1px;
  height: 1px;
  overflow: hidden;
}

/* ================================== */
/* PRINT STYLES */
/* ================================== */

@media print {
  .no-print,
  nav,
  aside,
  .skip-link,
  button,
  [role="button"] {
    display: none !important;
  }
  
  a::after {
    content: " (" attr(href) ")";
    font-size: 0.8em;
    color: #666;
  }
  
  .error-summary {
    border: 2px solid #000;
    background: #fff;
  }
}

/* ================================== */
/* RESPONSIVE BREAKPOINT UTILITIES */
/* ================================== */

/* Touch-friendly spacing on mobile */
@media (max-width: 768px) {
  .mobile-touch-spacing {
    gap: 24px;
  }
  
  .mobile-touch-padding {
    padding: 12px;
  }
  
  /* Larger touch targets on mobile */
  button,
  [role="button"],
  input,
  select,
  textarea {
    min-height: 48px;
  }
}

/* Desktop optimizations */
@media (min-width: 1024px) {
  .desktop-compact {
    gap: 16px;
  }
  
  .desktop-compact button,
  .desktop-compact [role="button"] {
    min-height: 36px;
    min-width: 36px;
  }
}

/* ================================== */
/* UTILITY CLASSES */
/* ================================== */

/* Accessible hiding */
.accessible-hide {
  clip: rect(1px, 1px, 1px, 1px);
  position: absolute !important;
  height: 1px;
  width: 1px;
  overflow: hidden;
}

/* Focus trap boundary */
.focus-trap {
  position: relative;
}

.focus-trap::before,
.focus-trap::after {
  content: '';
  position: absolute;
  width: 1px;
  height: 1px;
  top: 0;
  left: 0;
}

/* Announce text changes */
.announce-change {
  clip: rect(1px, 1px, 1px, 1px);
  position: absolute;
  height: 1px;
  width: 1px;
  overflow: hidden;
}

/* ================================== */
/* COMPONENT SPECIFIC STYLES */
/* ================================== */

/* Modal focus management */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 1000;
}

.modal-content {
  position: relative;
  background: white;
  border-radius: 8px;
  max-height: 90vh;
  overflow-y: auto;
  margin: 5vh auto;
  max-width: calc(100vw - 32px);
}

/* Form grouping */
fieldset {
  border: 2px solid var(--border-default);
  border-radius: 4px;
  padding: 16px;
  margin: 16px 0;
}

legend {
  padding: 0 8px;
  font-weight: 600;
  color: var(--text-primary);
}

/* Table accessibility */
table {
  border-collapse: collapse;
  width: 100%;
}

th {
  background: var(--bg-tertiary);
  padding: 12px;
  text-align: left;
  font-weight: 600;
  border: 1px solid var(--border-default);
}

td {
  padding: 12px;
  border: 1px solid var(--border-default);
}

/* Responsive table wrapper */
.table-responsive {
  overflow-x: auto;
  margin: 16px 0;
}

.table-responsive table {
  min-width: 600px;
}

/* ================================== */
/* DEBUGGING UTILITIES */
/* ================================== */

/* Focus debugging - remove in production */
.debug-focus *:focus {
  outline: 3px solid red !important;
  outline-offset: 2px !important;
}

.debug-touch-targets * {
  min-height: 44px !important;
  min-width: 44px !important;
  background: rgba(255, 0, 0, 0.1) !important;
}

/* ================================== */
/* VENDOR PREFIXES FOR OLDER BROWSERS */
/* ================================== */

/* Webkit scrollbar styling for better accessibility */
::-webkit-scrollbar {
  width: 16px;
  height: 16px;
}

::-webkit-scrollbar-track {
  background: var(--bg-tertiary);
}

::-webkit-scrollbar-thumb {
  background: var(--border-hover);
  border-radius: 8px;
  border: 2px solid var(--bg-tertiary);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--text-disabled);
}

/* Firefox scrollbar styling */
html {
  scrollbar-width: auto;
  scrollbar-color: var(--border-hover) var(--bg-tertiary);
}

/* ================================== */
/* COMPONENT STATE MANAGEMENT */
/* ================================== */

/* Loading states */
[aria-busy="true"] {
  pointer-events: none;
  opacity: 0.7;
}

/* Disabled states */
[disabled],
[aria-disabled="true"] {
  opacity: 0.6;
  cursor: not-allowed;
  pointer-events: none;
}

/* Selected states */
[aria-selected="true"] {
  background: var(--info-bg);
  border-color: var(--info-text);
}

/* Expanded states */
[aria-expanded="true"] {
  background: var(--bg-tertiary);
}

/* Invalid states */
[aria-invalid="true"] {
  border-color: var(--error-text);
  background: var(--error-bg);
}

/* ================================== */
/* PROGRESSIVE ENHANCEMENT */
/* ================================== */

/* No-JS fallbacks */
.no-js .js-only {
  display: none !important;
}

.no-js .no-js-show {
  display: block !important;
}

/* Enhanced features for modern browsers */
@supports (display: grid) {
  .grid-enhanced {
    display: grid;
    gap: 16px;
  }
}

@supports (backdrop-filter: blur(10px)) {
  .backdrop-blur {
    backdrop-filter: blur(10px);
  }
}